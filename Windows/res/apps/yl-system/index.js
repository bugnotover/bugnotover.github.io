"use strict";var YL=parent.YL;YLApp.onReady(function(){YLApp.onEvent(function(a){switch(a.event){case"setColorFromColorPicker":var t=a.data;"colors"===n.navActive&&(n.colorChoose=t),"app-manager"===n.navActive&&(n.appSetting.icon.bg=t);break;case"dataChanged":0===a.from&&n.ondataChanged()}});var n=new Vue({el:"#app",created:function(){document.body.focus();var t=this;YL.static.changeable&&YL.static.dataCenter?(this.loadApps(),YLApp.data.nav&&(this.navActive=YLApp.data.nav),YLApp.data.appSetting&&(this.appSetting=this.apps[YLApp.data.appSetting]),this.syncData(),this.refreshData()):this.navActive="aboutUs";function a(){var a=Yuri2.getClientSize();t.isSmallScreen=a.width<=768}a(),$(window).resize(a),$("body").css("opacity",1)},data:{navActive:"app-manager",navs:{"app-manager":{icon:"puzzle-piece",text:YL.lang("AppManager"),disable:!YL.static.changeable},colors:{icon:"paint-brush",text:YL.lang("Color"),disable:!YL.static.changeable},wallpaper:{icon:"image",text:YL.lang("Wallpaper"),disable:!YL.static.changeable},others:{icon:"tasks",text:YL.lang("Others"),disable:!YL.static.changeable},"data-manage":{icon:"database",text:YL.lang("DataManager"),disable:!(YL.static.changeable&&YL.static.dataCenter)},YLUI:{icon:"yoast",text:"YLUI"},aboutUs:{icon:"info-circle",text:YL.lang("AboutUs")}},apps:{},appSearchWords:"",colors:["#FFB900","#FF8C00","#F7630C","#CA5010","#DA3B01","#EF6950","#D13438","#D13438","#E74856","#E81123","#EA005E","#C30052","#E3008C","#BF0077","#C239B3","#9A0089","#0078D7","#0063B1","#8E8CD8","#6B69D6","#8764B8","#744DA9","#B146C2","#881798","#0099BC","#2D7D9A","#00B7C3","#038387","#00B294","#018574","#00CC6A","#10893E","#7A7574","#5D5A58","#68768A","#515C6B","#567C73","#486860","#498205","#107C10","#767676","#4C4A48","#69797E","#4A5459","#647C64","#525E54","#847545","#7E735F"],colorChoose:"",autoThemeColor:!1,themeColorNow:"",wallpaperNow:"",wallpapers:[],wallpaperBlur:!1,wallpaperSlide:!1,wallpaperSlideRandom:!1,wallpaperSlideItv:5,wallpaperAddUrl:"",openMax:9,topTaskBar:!1,activeAppId:null,textData:"",btnEnableLoading:!1,appSetting:null,appSettingForm:{},isSmallScreen:!1,dataChanged:!1},watch:{appSetting:{handler:function(a,t){a||(YL.vue.$set(YL.vue,"apps",Yuri2.jsonDeepCopy(this.apps)),layer.msg("已保存"))}},colorChoose:{handler:function(a,t){this.autoThemeColor||(YL.vue.configs.themeColor=a)}},autoThemeColor:{handler:function(a,t){(YL.vue.configs.autoThemeColor=a)?YL.vue.backgroundToThemeColor():YL.vue.configs.themeColor=this.colorChoose}},wallpaperBlur:{handler:function(a,t){YL.vue.configs.wallpaperBlur=this.wallpaperBlur}},wallpaperSlide:{handler:function(a,t){YL.vue.configs.wallpaperSlide=this.wallpaperSlide}},wallpaperSlideRandom:{handler:function(a,t){YL.vue.configs.wallpaperSlideRandom=this.wallpaperSlideRandom}},wallpaperSlideItv:{handler:function(a,t){YL.vue.configs.wallpaperSlideItv=this.wallpaperSlideItv}},topTaskBar:{handler:function(a,t){YL.vue.configs.topTaskBar=this.topTaskBar}},openMax:{handler:function(a,t){YL.vue.configs.openMax=this.openMax}}},computed:{wallpaperNowFixed:function(){return this.urlFix(this.wallpaperNow)}},methods:{syncData:function(){var a=this;try{var t=YL.util.dataCopy("configs");a.themeColorNow=t.themeColor,a.autoThemeColor=t.autoThemeColor,a.wallpaperNow=t.wallpaper,a.wallpapers=t.wallpapers,a.wallpaperBlur=t.wallpaperBlur,a.wallpaperSlide=t.wallpaperSlide,a.wallpaperSlideRandom=t.wallpaperSlideRandom,a.wallpaperSlideItv=t.wallpaperSlideItv,a.openMax=t.openMax,a.topTaskBar=t.topTaskBar,a.colorChoose||(a.colorChoose=t.themeColor)}catch(a){YL.debug(a)}},ondataChanged:function(){this.dataChanged=!0,this.syncData()},appCreate:function(a){var t="";if(/^[\w-.]+$/.test(a)&&!this.apps[a])t=a;else for(;t="app-"+YL.util.getID(),this.apps[t];);var e=YL.util.getAppDataTemplate();e.title=a,e.icon.type="str",e.icon.content=a,this.$set(this.apps,t,e)},appContextMenu:function(a,t){var e=this,n=this.apps[a],o=["<span style='color: darkgray'>"+YL.util.getStrFa("pencil")+n.title+"</span>","|",[YL.util.getStrFa("play-circle")+YL.lang("Open"),function(){YL.open(a)}],[YL.util.getStrFa("copy")+YL.lang("AddTo"),[[YL.util.getStrFa("desktop")+YL.lang("DesktopIcons"),function(){e.appAddToShortcut(a)}],[YL.util.getStrFa("list-ul")+YL.lang("MainMenu"),function(){e.appAddToMenu(a)}],[YL.util.getStrFa("sliders")+YL.lang("Sidebar"),function(){e.appAddToSidebar(a)}],[YL.util.getStrFa("square")+YL.lang("Tiles"),function(){e.appAddToTile(a)}]]],[YL.util.getStrFa("cogs")+YL.lang("Advance"),function(){e.appSetting=n}],"|",[YL.util.getStrFa("trash")+YL.lang("Uninstall"),function(){e.uninstall(a)}]];ContextMenu.render(t,o,this)},jsonImport:function(){var t=this,a=$("#ipt-json-file"),e=new FileReader;e.readAsText(a[0].files[0],"utf8"),e.onload=function(a){t.textData=a.target.result}},jsonExport:function(){var a=new Blob([this.textData],{type:"text/plain;charset=utf-8"});Yuri2.saveAs(a,"yl-data.json")},refreshData:function(){var a=YL.export();this.textData=Yuri2.jsonFormat(a),this.dataChanged=!1},btnClipboard:function(){var a=new clipboard.DT;a.setData("text/plain",this.textData),clipboard.write(a),layer.msg(YL.lang("CopiedToShearPlate"))},enableData:function(){var t=this;this.btnEnableLoading=!0,setTimeout(function(){try{var a=JSON.parse(t.textData);YL.import(a)}catch(a){layer.msg(YL.lang("FormatError")),t.btnEnableLoading=!1}},500)},renderAutoRun:function(a){try{return 0<a?"Lv"+Math.floor(a):YL.lang("Disabled")}catch(a){return YL.lang("ConfigurationError")}},urlFix:function(a){return"."===a[0]?"../../../"+a:a},loadApps:function(){var a=YL.util.dataCopy("apps");this.apps=a},navStyle:function(a){var t=this.themeColorNow;return a===this.navActive?{color:t,"border-left":"5px solid "+t}:{}},uninstall:function(a){var t=this.apps[a],e=layer.confirm(Yuri2.template(YL.lang("UninstallConfirm"),t.title),{skin:"yl"},function(){layer.close(e),YL.uninstall(a)&&n.$delete(n.apps,a)})},appOpen:function(a){YL.open(a)},appAddToShortcut:function(a){YL.addShortcut(a),layer.msg(YL.lang("Added"))},appAddToMenu:function(a){YL.addMenuItem(a),layer.msg(YL.lang("Added"))},appAddToSidebar:function(a){YL.addSidebarBtn(a),layer.msg(YL.lang("Added"))},appAddToTile:function(a){YL.addTile(a),layer.msg(YL.lang("Added"))},appSearchMatch:function(a){var t=this.apps[a],e=this.appSearchWords;if(!e)return!0;var n,o=[a,t.title,t.desc,t.poweredBy,this.renderAutoRun(t.autoRun)];for(n in o){var l=o[n];if("string"==typeof l&&-1!==l.indexOf(e))return!0}return!1},btnAutoTheme:function(){return this.autoThemeColor?{background:this.themeColorNow,color:"white"}:{background:"rgb(230,230,230)",color:"black"}},btnAddBgClick:function(){var a=this.wallpaperAddUrl;a&&(YL.vue.configs.wallpapers.push({image:a,preview:""}),this.wallpaperAddUrl="")},imgContextMenu:function(e,a){var t=[[YL.util.getStrFa("play")+YL.lang("Enabled"),function(){YL.vue.configs.wallpaper=e.image}],[YL.util.getStrFa("remove")+YL.lang("Delete"),function(){for(var a=YL.vue.configs.wallpapers,t=0;t<a.length;t++)if(a[t].image===e.image)return void a.splice(t,1)}]];ContextMenu.render(a,t,this)},_checkAutoRunLevel:function(a){(isNaN(a.autoRun)||a.autoRun<0)&&(a.autoRun=0)},reduceAutoRunLevel:function(a){this._checkAutoRunLevel(a),a.autoRun--,this._checkAutoRunLevel(a)},increaseAutoRunLevel:function(a){this._checkAutoRunLevel(a),a.autoRun++,this._checkAutoRunLevel(a)}}})});